---
title: "00_Replication"
author: "April Wright & Graeme Lloyd"
date: "11/11/2019"
output: html_document
---

Before you begin, install the package with:

```{r}
devtools::install_github("graemetlloyd/ProjectWhalehead")
```

To reproduce the paper, you will make sure all the tips have both data and metadata. If they do, you will get ages from PBDB.

```{r}
Whalehead::build_ages("data/NEXUS/", "Data/XML/", "Data/Ages")
```

Then, you will check the datasets to make sure all the tips have names and those names can be synchronized across data sources. Also, disregard any sets with missing tip ages.


```{r}
remove_unreconciled("data/XML")
remove_missing_tips("data/XML")
```



We have included the scripts to estimate phylogenetic trees from the data. This is time-intensive and we will not reproduce this analysis in this notebook. We will skip straight to making the stratigraphic congruence output.
```{r pressure, echo=FALSE}
make_strat_congruence("data/CombinedTrees/", "data/NEXUS/", "data/Ages/", "data/MPTS/", "revbayes_output", "parisimony_out")
```

Next, we can summarize the data in a few ways.  To make table two:

```{r}
fi <- list.files("data/StratCongruenceResults/")
sapply(fi, summary_stat)
```

Or your could summarize all of the files at once:

```{r}
summarize_medians(user.path = "data/StratCongruenceResults/")
```


Or make violin and box plots of them:

```{r}

files <- list.files(path = user.path, pattern = "*.txt", full.names = TRUE, recursive = FALSE)
dir.create("ViolinPlots")
lapply(files, makeViolins)
dir.create("boxPlots")
lapply(files, makeBoxplot)

```

Finally, you can make our custom treespace visuals. These are compute intensive, so only one is shown here.

```{r}
library(rwty)
dir.create("data/TreeSpacePlots/")
custom_plots(CombinedTrees = "data/CombinedTrees/Aguirre-Fernandez_etal_2009a.nex", StratFile ="data/StratCongruenceResults/Aguirre-Fernandez_etal_2009a.txt", ext_columns = c("MIG", "Bayes"))
```
